angular.module("kitchenFriend",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("Login",{url:"/login",templateUrl:"html/views/login.html",controller:"loginCtrl"}).state("Home",{url:"/home",templateUrl:"html/views/userHome.html",controller:"userHomeCtrl"}).state("Recipes",{url:"/recipes",templateUrl:"html/views/userRecipes.html",controller:"userRecipesCtrl"}).state("NewRecipe",{url:"/newRecipe",templateUrl:"html/views/newRecipe.html",controller:"newRecipeCtrl"}).state("UserAccount",{url:"/userAccount",templateUrl:"html/views/userAccount.html",controller:"userAccountCtrl"}).state("BrowseRecipes",{url:"/browse",templateUrl:"html/views/browseRecipes.html",controller:"browseRecipesCtrl"}).state("Recipe",{url:"/recipe/:recipeId",templateUrl:"html/views/recipe.html",controller:"recipeCtrl"}).state("RecipeEdit",{url:"/editRecipe/:recipeId",templateUrl:"html/views/recipeEdit.html",controller:"recipeEditCtrl"}).state("RecipeShare",{url:"/shareRecipe/:recipeId",templateUrl:"html/views/recipeShare.html",controller:"recipeShareCtrl"}).state("RecipePublic",{url:"/publicRecipe/:recipeId",templateUrl:"html/views/recipePublic.html",controller:"recipePublicCtrl"}).state("Group",{url:"/group",templateUrl:"html/views/group.html",controller:["$state",function(e){"/group"===e.current.url&&e.go("Group.Home")}]}).state("Group.Dashboard",{url:"/dashboard",templateUrl:"html/views/groupDashboard.html"}).state("Group.Admin",{url:"/admin",templateUrl:"html/views/groupAdmin.html"}).state("Group.Recipes",{url:"/recipes",templateUrl:"html/views/groupRecipes.html"}).state("Group.Members",{url:"/members",templateUrl:"html/views/groupMembers.html"}).state("Group.Home",{url:"/home",templateUrl:"html/views/groupHome.html"}),t.otherwise("/login")}]),angular.module("kitchenFriend").controller("browseRecipesCtrl",["$scope","publicRecipeService",function(e,t){t.getPublicRecipes().then(function(t){e.recipes=t})}]),angular.module("kitchenFriend").controller("cookCtrl",["$scope","recipeService",function(e,t){t.getCookedRecipes().then(function(t){e.recipes=t})}]),angular.module("kitchenFriend").controller("loginCtrl",["$scope","$location","authService",function(e,t,i){e.localLogin=function(e){console.log("Logging in as: ",e),i.localLogin(e).then(function(e){e&&(console.log("redirecting"),t.path("/home"))})["catch"](function(e){console.log("Login Error: ",e)})},e.localSignup=function(e){console.log("Signup up locally with: ",e),i.createLocalUser(e).then(function(e){e&&console.log("Account Created")})["catch"](function(e){console.log("Account not created"),"Username already exists."===e.data&&window.alert("Username in use, please try again.")})}}]),angular.module("kitchenFriend").controller("newRecipeCtrl",["$scope",function(e){}]),angular.module("kitchenFriend").controller("recipeCtrl",["$scope","$stateParams","recipeService",function(e,t,i){e.isLoading=!0,i.getRecipeById(t.recipeId).then(function(t){e.recipe=t,e.isLoading=!1,console.log("GOT RECIPE: ",t)})}]),angular.module("kitchenFriend").controller("recipeEditCtrl",["$scope","$state","$stateParams","recipeService",function(e,t,i,n){i.recipeId?n.getRecipeById(i.recipeId).then(function(t){e.recipe=t}):(console.log("Could not find recipe Id"),t.go("Home")),e.saveChanges=function(){n.updateRecipe(e.recipe).then(function(e){t.go("Recipe",{recipeId:e._id})})}}]),angular.module("kitchenFriend").controller("recipePublicCtrl",["$scope","publicRecipeService","$stateParams",function(e,t,i){t.getPublicRecipeById(i.recipeId).then(function(t){e.recipe=t,e.isLoading=!1,console.log("GOT RECIPE: ",t)})}]),angular.module("kitchenFriend").controller("recipeShareCtrl",["$scope","$state","$stateParams","recipeService","shareService","publicRecipeService",function(e,t,i,n,r,c){n.getRecipeById(i.recipeId).then(function(t){e.recipe=t}),e.currentView=0,e.shareRecipePublic=function(){e.termsCheck&&c.shareNewRecipe(e.recipe).then(function(){t.go("BrowseRecipes")})},e.shareRecipeWithUser=function(e){console.log("Shareing",e),e.recipeId=i.recipeId,r.shareUser(e).then(function(){t.go("Home")})["catch"](function(e){console.log("FOUND THE ERROR: ",e),"User does not exist"===e.data.message&&alert("Sorry, that user does not exist.")})},e.shareWithEmail=function(i){i.recipe=e.recipe,r.shareEmail().then(function(){t.go("Home")})}}]),angular.module("kitchenFriend").controller("shoppingListCtrl",["$scope",function(e){e.shoppingList=[]}]),angular.module("kitchenFriend").controller("userAccountCtrl",["$scope",function(e){}]),angular.module("kitchenFriend").controller("userHomeCtrl",["$scope","shareService",function(e,t){t.getUsersMail().then(function(t){e.allMail=t.recipeShares,console.log("mail: ",t.recipeShares)}),e.deleteFunction=function(t){for(var i=0;i<e.allMail.length;i++)e.allMail[i].recipeId._id===t&&e.allMail.splice(i,1)}}]),angular.module("kitchenFriend").controller("userRecipesCtrl",["$scope","recipeService",function(e,t){var i=function(){t.getCurrentUsersRecipes().then(function(t){e.recipes=t.recipes})};i()}]),angular.module("kitchenFriend").directive("myHeader",function(){return{templateUrl:"html/templates/header.html",scope:{forceAuth:"@"},controller:["$scope","authService","$state",function(e,t,i){e.loggedIn=!1,t.getAuth().then(function(t){e.loggedIn=!0,console.log("User logged in: ",t)})["catch"](function(t){e.loggedIn=!1,console.log("No user logged in",e.forceAuth),e.forceAuth&&i.go("Login")}),e.logout=function(){t.logout().then(function(e){i.go("Login")})}}]}}),angular.module("kitchenFriend").directive("loading",function(){return{template:'<p ng-show="isloading">Loading...</p>',scope:{isLoading:"="}}}),angular.module("kitchenFriend").directive("newLinkRecipe",function(){return{templateUrl:"html/templates/newLinkRecipe.html",link:function(e,t,i){e.loading=!1,e.couldNotFindRecipe=!1,e.foundRecipe=!1,e.findRecipe=function(t){e.loading=!0},e.saveRecipe=function(e){console.log("Saving")}}}}),angular.module("kitchenFriend").directive("newUserRecipe",["recipeService","$state",function(e,t){return{templateUrl:"html/templates/newUserRecipe.html",scope:{},link:function(i,n,r){i.newRecipe={ingredients:[],directions:[]},i.addIngredient=function(e){i.newRecipe.ingredients.push(e),i.newIngredient=""},i.removeIngredient=function(e){i.newRecipe.ingredients.splice(e,1)},i.orderIngredient=function(e,t){var n=i.newRecipe.ingredients[e];i.newRecipe.ingredients[e]=i.newRecipe.ingredients[e+t],i.newRecipe.ingredients[e+t]=n},i.addDirection=function(e){i.newRecipe.directions.push(e),i.newDirection=""},i.removeDirection=function(e){i.newRecipe.directions.splice(e,1)},i.orderDirection=function(e,t){var n=i.newRecipe.directions[e];i.newRecipe.directions[e]=i.newRecipe.directions[e+t],i.newRecipe.directions[e+t]=n},i.saveRecipe=function(){c()&&(console.log("Recipe Passed Validation"),e.saveNewRecipe(i.newRecipe).then(function(e){console.log("Recipe Saved"),t.go("Recipes")}))};var c=function(){return i.newRecipe.name?i.newRecipe.description?null===i.newRecipe.prepTime?(console.log("Prep Time Failed"),!1):null===i.newRecipe.cookTime?(console.log("Cook Time Failed"),!1):i.newRecipe.ingredients?i.newRecipe.directions?!0:(console.log("Directions Failed"),!1):(console.log("Ingredients Failed"),!1):(console.log("Description Failed"),!1):(console.log("Name Failed"),!1)}}}}]),angular.module("kitchenFriend").directive("recipeFull",function(){return{templateUrl:"html/templates/recipeFull.html"}}),angular.module("kitchenFriend").directive("recipeInteractions",["recipeService",function(e){return{templateUrl:"html/templates/recipeInteractions.html",scope:{recipeId:"=",layout:"@"},controller:["$scope","$state",function(t,i){t.classStuff={"recipe-interactions-expanded-fixed":"expanded-fixed"===t.layout},t.editRecipe=function(){t.recipeId&&i.go("RecipeEdit",{recipeId:t.recipeId})},t.shareRecipe=function(){t.recipeId&&i.go("RecipeShare",{recipeId:t.recipeId})},t.deleteRecipe=function(){window.confirm("Are you sure you want to delete this recipe?")&&t.recipeId&&e.deleteRecipe(t.recipeId).then(function(e){i.go("Recipes")})},t.printRecipe=function(){alert("Not Finished Yet")}}]}}]),angular.module("kitchenFriend").directive("recipeMail",function(){return{templateUrl:"html/templates/recipeMail.html",scope:{mail:"=",deleteFunction:"&delete"},controller:["$scope","shareService","$state",function(e,t,i){e.message=e.mail,console.log("MESSAGE: ",e.message),e.acceptMail=function(i){t.acceptShare(i).then(function(){console.log("refresh needed: ",i),e.deleteFunction({recipeId:i})})},e.rejectMail=function(i){console.log("REJECTING"),t.rejectShare(i).then(function(t){console.log("refresh Needed from rejecting: ",t),e.deleteFunction({recipeId:i})})}}]}}),angular.module("kitchenFriend").directive("recipePreview",function(){return{templateUrl:"html/templates/recipePreview.html",scope:{recipe:"=",browse:"@"},controller:["$scope","$state",function(e,t){e.openRecipe=function(){console.log("CLICKED VIEW WITH: ",e.browse),e.browse?t.go("RecipePublic",{recipeId:e.recipe._id}):t.go("Recipe",{recipeId:e.recipe._id})}}]}}),angular.module("kitchenFriend").service("authService",["$http",function(e){this.createLocalUser=function(t){return e({method:"POST",url:"/auth/signup",data:t})},this.localLogin=function(t){return e({method:"POST",url:"/auth/local",data:t})},this.getAuth=function(){return e({method:"GET",url:"/auth/current"})},this.logout=function(){return e({method:"GET",url:"/auth/logout"})}}]),angular.module("kitchenFriend").service("publicRecipeService",["$http",function(e){var t=function(e){return e.data};this.getPublicRecipes=function(){return e({method:"GET",url:"/api/publicRecipes"}).then(t)},this.shareNewRecipe=function(i){return e({method:"POST",url:"/api/share/public",data:i}).then(t)},this.getPublicRecipeById=function(i){return e({method:"GET",url:"/api/publicRecipes/"+i}).then(t)}}]),angular.module("kitchenFriend").service("recipeService",["$http",function(e){this.getCurrentUsersRecipes=function(){return e({method:"GET",url:"/api/recipes"}).then(t)},this.saveNewRecipe=function(i){return e({method:"POST",url:"/api/recipes",data:i}).then(t)},this.getRecipeById=function(i){return e({method:"GET",url:"/api/recipe/"+i}).then(t)},this.updateRecipe=function(i){return e({method:"PUT",url:"/api/updateRecipe",data:i}).then(t)},this.deleteRecipe=function(i){return e({method:"DELETE",url:"/api/recipe/"+i}).then(t)};var t=function(e){return e.data}}]),angular.module("kitchenFriend").service("shareService",["$http",function(e){this.shareUser=function(i){return e({method:"POST",url:"/api/share/user",data:i}).then(t)},this.shareEmail=function(i){return e({method:"POST",url:"/api/share/email",data:i}).then(t)},this.getUsersMail=function(){return e({method:"GET",url:"/api/share"}).then(t)},this.acceptShare=function(i){return console.log("Sending Id: ",i),e({method:"PUT",url:"/api/share/accept/"+i}).then(t)},this.rejectShare=function(i){return e({method:"PUT",url:"/api/share/reject/"+i}).then(t)};var t=function(e){return e.data}}]),angular.module("kitchenFriend").service("shoppingListService",["$http",function(e){var t=function(e){return e.data},i=function(e){return console.error(e),null};this.getUsersList=function(n){var r="/api/shoppingList";return n&&(r+="?userId="+n),e({method:"GET",url:r}).then(t)["catch"](i)},this.addItemToList=function(n){return e({method:"POST",url:"/api/shoppingList",data:n}).then(t)["catch"](i)},this.removeItemFromList=function(n){return e({method:"DELETE",url:"/api/shoppingList",data:n}).then(t)["catch"](i)}}]);